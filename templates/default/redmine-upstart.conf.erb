start on runlevel [2345]
stop on runlevel [!2345]

respawn

<% @env_vars.each do |key, value| -%>
<%# Escape \ " and NULL characters -%>
env <%= key.upcase %>="<%= value.gsub(/["\\\x0]/, '\\\\\0') %>"
<% end -%>

setuid <%= @user %>

chdir <%= @app_path %>

exec <%= @ruby_command %> script/rails s thin -p 3000
